---
interface Props {
  referralCode: string;
  buttonText?: string;
  visitUrl?: string;
  visitButtonText?: string;
}

const {
  referralCode,
  buttonText = 'Copy Fizz Promo Code',
  visitUrl = 'https://fizz.ca/en?ref=HN9SM',
  visitButtonText = 'Visit Fizz.ca',
} = Astro.props;

// Generate a unique ID for this component instance
const uniqueId = `clipboard-${Math.random().toString(36).substring(2, 9)}`;
---

<div class="max-w-xl mx-auto rounded-2xl bg-transparent p-4 md:p-8 -mt-4 md:mt-0">
  <div class="text-center space-y-6">
    <!-- Promo Code Display -->
    <div class="border-2 border-dashed border-purple-500 rounded-xl px-6 py-8">
      <div class="text-4xl font-bold tracking-[0.35em] text-purple-600">{referralCode}</div>
    </div>

    <!-- Buttons Container - Stacked Vertically with Gap -->
    <div class="flex flex-col gap-4">
      <!-- Button 1: Copy Fizz Promo Code -->
      <button
        type="button"
        id={`${uniqueId}-copy`}
        data-code={referralCode}
        class="w-full flex items-center justify-center gap-3 rounded-xl border-2 transition-all duration-200 font-bold py-4 px-8 text-lg shadow-md bg-purple-600 border-purple-700 text-white hover:bg-purple-700 hover:shadow-lg min-w-[320px]"
      >
        <span id={`${uniqueId}-text`}>1. {buttonText}</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2.2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
          ></path>
        </svg>
      </button>

      <!-- Button 2: Visit Fizz.ca -->
      <a
        href={visitUrl}
        target="_blank"
        rel="noopener noreferrer"
        class="w-full flex items-center justify-center gap-3 rounded-xl border-2 transition-all duration-200 font-bold py-4 px-8 text-lg shadow-md bg-gray-200 border-gray-300 text-gray-700 hover:bg-gray-300 hover:shadow-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-600"
      >
        2. {visitButtonText}
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2.2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
        </svg>
      </a>
    </div>

    <p class="text-sm text-slate-500 leading-relaxed">
      Click to copy â€¢ Valid for new Fizz users only
      <br />
      Verified for <span id={`${uniqueId}-date`}></span>
    </p>
  </div>
</div>

<script is:inline define:vars={{ uniqueId, referralCode, buttonText }}>
  // Initialize date
  const dateEl = document.getElementById(`${uniqueId}-date`);
  if (dateEl) {
    const now = new Date();
    const options = { year: 'numeric', month: 'long' };
    dateEl.textContent = now.toLocaleDateString('en-US', options);
  }

  // Copy button functionality
  const copyBtn = document.getElementById(`${uniqueId}-copy`);
  const textEl = document.getElementById(`${uniqueId}-text`);

  if (copyBtn && textEl) {
    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(referralCode);

        // Show success state
        textEl.textContent = 'Copied!';
        copyBtn.classList.remove('bg-purple-600', 'border-purple-700');
        copyBtn.classList.add('bg-emerald-500', 'border-emerald-600');

        // Reset after 2 seconds
        setTimeout(() => {
          textEl.textContent = `1. ${buttonText}`;
          copyBtn.classList.remove('bg-emerald-500', 'border-emerald-600');
          copyBtn.classList.add('bg-purple-600', 'border-purple-700');
        }, 2000);
      } catch (err) {
        console.error('Failed to copy text: ', err);
      }
    });
  }
</script>
